@model CRACKED.Dtos.UsuarioViewModel

<div class="container-fluid d-flex justify-content-center ">
    <div class="form-group p-lg-4 bg rounded shadow" style="max-width: 800px; width: 100%;">
        <h2 style="color:saddlebrown; font-family: cursive; font-weight:bold;">
            Usuario @Model.IdUsuario
        </h2>

        <!-- Campos de información del usuario (habilitados para vista y edición) -->
        <div class="mb-3">
            <label for="InputNombre" class="form-label"><h8 style="color:black;">Nombre</h8></label>
            <input type="text" id="InputNombre" class="form-control" name="Nombre" value="@Model.Nombre" required>
        </div>
        <div class="mb-3">
            <label for="InputApellido" class="form-label"><h8 style="color:black;">Apellido</h8></label>
            <input type="text" id="InputApellido" class="form-control" name="Apellido" value="@Model.Apellido" required>
        </div>
        <div class="mb-3">
            <label for="InputTelefono" class="form-label"><h8 style="color:black;">Celular</h8></label>
            <input type="text" id="InputTelefono" class="form-control" name="NumeroContacto" value="@Model.NumeroContacto" required>
        </div>
        <div class="mb-3">
            <label for="InputCorreo" class="form-label"><h8 style="color:black;">Correo</h8></label>
            <input type="email" id="InputCorreo" class="form-control" name="CorreoElectronico" value="@Model.CorreoElectronico" required>
        </div>

        <!-- Selección de Estado -->
        <div class="mb-3">
            <label for="selectEstado" class="form-label">Estado</label>
            <select id="selectEstado" name="IdEstado" class="form-select" aria-label="Estado" required>
                <option value="1" @(Model.IdEstado == 1 ? "selected" : "")>Activo</option>
                <option value="2" @(Model.IdEstado == 2 ? "selected" : "")>Inactivo</option>
            </select>
        </div>

        <!-- Selección de Rol -->
        <div class="mb-3">
            <label for="selectRol" class="form-label">Rol</label>
            <select id="selectRol" name="IdRol" class="form-select" aria-label="Rol" required>
                <option value="3" @(Model.IdRol == 3 ? "selected" : "")>Domiciliario</option>
                <option value="2" @(Model.IdRol == 2 ? "selected" : "")>Administrador</option>
                <option value="1" @(Model.IdRol == 1 ? "selected" : "")>Cliente</option>
            </select>
        </div>

        <!-- Formulario para Guardar Cambios -->
        <div class="row justify-content-start">
            <div class="col-4 mb-3">
                <form id="formActualizarUsuario" asp-action="ActualizarUsuario" asp-controller="Admin" method="post" onsubmit="return validateForm();">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="IdUsuario" value="@Model.IdUsuario" />
                    <button class="btn btn-primary" type="submit">Guardar cambios</button>
                </form>
            </div>

            <!-- Formulario para Eliminar Usuario -->
            <div class="col-4 mb-3">
                <button class="btn btn-danger" onclick="eliminarUsuario(@Model.IdUsuario)">Eliminar usuario</button>
            </div>
        </div>

    </div>
</div>

<!-- JavaScript para validaciones y acciones -->
<script>
    // Validación del formulario de actualización
    function validateForm() {
        var nombre = document.getElementById('InputNombre').value;
        var apellido = document.getElementById('InputApellido').value;
        var celular = document.getElementById('InputTelefono').value;
        var correo = document.getElementById('InputCorreo').value;
        var estado = document.getElementById('selectEstado').value;
        var rol = document.getElementById('selectRol').value;

        if (!nombre || !apellido || !celular || !correo || !estado || !rol) {
            alert("Todos los campos son obligatorios.");
            return false;
        }
        return true;
    }

    // Función AJAX para eliminar usuario
    function eliminarUsuario(id) {
        if (confirm("¿Estás seguro de que deseas eliminar este usuario?")) {
            // Enviar solicitud AJAX para eliminar el usuario
            fetch(`/Admin/EliminarUsuario`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() // Incluye el token CSRF
                },
                body: JSON.stringify({ idUsuario: id })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Usuario eliminado correctamente.");
                        window.location.href = '/Admin/Index'; // Redirige a la lista de usuarios
                    } else {
                        alert("Hubo un error al eliminar el usuario.");
                    }
                })
                .catch(error => {
                    alert("Hubo un error en la solicitud.");
                    console.error(error);
                });
        }
    }
</script>
